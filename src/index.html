<html>
    <head>
        <title>Dr. Evil Web Debugger</title>
        <style>
            body {
                margin: 50px;
                font-family: Monospace;
            }
            #log {
                border: 3px solid black;
                width: 100%;
                height: 500px;
                overflow: auto;
            }
            #entry {
                width: 80em;
            }
            div.error {
                color: red;
            }
        </style>
    </head>
    <body>
        <h1>Dr. Evil Web Debugger</h1>
        <div id="log"></div>
        <input id="entry" /> <button id="submit">Run</button>
    </body>
    <script
        src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js">
    </script>
    <script
        src="http://flesler-plugins.googlecode.com/files/jquery.scrollTo-1.4.2-min.js">
    </script>
    <script>
        function append_log(div) {
            $('#log').append(div);
            $('#log').scrollTo(div);
        }

        function on_result(data) {
            var div = $('<div/>');
            if (data.error) {
                div.attr('class', 'error');
                if (data.result.length == 0) {
                    data.result = "Unknown Error!";
                }
            }
            div.text(data.result);
            append_log(div);
        }

        function on_run() {
            var expr = $.trim($('#entry').val());
            if (expr.length == 0) {
                return;
            }
            var div = $('<div/>').text('=> ' + expr);
            append_log(div);
            $.ajax({
                type: 'POST',
                url: '/',
                data: { "expr" : expr },
                success: on_result,
                dataType: 'json'
            });
        }

        function hook_enter_key(elem, handler) {
            elem.keyup(function(e) {
                if (e.keyCode == 13) {
                    handler();
                }
            });
        }

        $(document).ready(function() {
            $('#submit').click(on_run);
            hook_enter_key($('#entry'), on_run);
        });
    </script>
</html>
